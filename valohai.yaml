---

- step:
    name: Train model
    image: gw000/keras:1.2.2-py2-th-gpu
    command: ./run --mode c2w2c {parameters}
    #inputs:
    #  - name: training-set-images
    #    default: https://valohai-mnist.s3.amazonaws.com/train-images-idx3-ubyte.gz
    parameters:
      - name: training_dataset
        pass-as: --training {v}
        description: Training dataset filename
        type: str
        default: data/training.txt
      - name: validation_dataset
        pass-as: --test {v}
        description: Validation dataset filename
        type: str
        default: data/validation.txt
      - name: num_epoch
        pass-as: --num-epoch {v}
        description: Number of epoch
        type: integer
        default: 200
      - name: learning_rate
        pass-as: --learning-rate {v}
        description: Initial learning rate
        type: float
        default: 0.001
      - name: max_word_length
        pass-as: -w {v}
        description: Maximum word length (longer words will be truncated)
        type: integer
        default: 21
      - name: batch_size
        pass-as: --batch-size {v}
        type: int
        description: Mini-batch size
        default: 50
      - name: d_C
        pass-as: --d_C {v}
        description: Character features vector size
        type: int
        default: 50
      - name: d_W
        pass-as: --d_W {v}
        description: Word features vector size
        type: int
        default: 50
      - name: d_Wi
        pass-as: --d_Wi {v}
        description: Intermediate word LSTM state dimension
        type: int
        default: 150
      - name: d_L
        pass-as: --d_L {v}
        description: Language model state dimension
        type: int
        default: 500
      - name: d_D
        pass-as: --d_D {v}
        description: W2C Decoder state dimension
        type: int
        default: 500

- step:
    name: Worker environment check
    image: gw000/keras:1.2.2-py2-th-gpu
    command:
      - pwd
      - ls -la
      - nvidia-smi
      - python --version
